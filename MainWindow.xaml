<Window x:Class="RecipeUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:RecipeUI"
        mc:Ignorable="d"
        Title="Receptes könyv" Height="600" Width="1100" MinHeight="400" MinWidth="1000" Icon="/Assets/chef_icon.ico">
    <Grid Background="{DynamicResource App.WindowBg}">
        <TabControl x:Name="MainTabs" SelectionChanged="MainTabs_SelectionChanged">
            <TabItem x:Name="tabRecept" Header="Receptek">
                <Grid Background="{DynamicResource App.PanelBg}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel Grid.Row="0" LastChildFill="False" Margin="10,10,10,6">
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                            <Button x:Name="BtnUjRecept" Command="{Binding OpenAddRecipeCommand}" Content="Recept hozzáadása" Margin="0,0,8,0" Height="32" Width="160"/>

                            <Button x:Name="BtnThemeToggle" Width="32" Height="32" Margin="0,0,8,0" BorderBrush="{DynamicResource App.Border}">
                                <Image x:Name="ImgTheme" Stretch="Uniform"/>
                            </Button>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <Button Command="{Binding AddToSelectedCommand}" Content="Hozzáadás a listához" Height="32" Width="160" Margin="0,0,8,0"/>
                            <Button Command="{Binding GenerateShoppingListCommand}" Content="Lista készítése" Height="32" Width="140" Margin="0,0,8,0"/>
                            <Button x:Name="BtnBeszerezve" Command="{Binding BeszerezveCommand}" Content="Beszerezve → Hűtő" Height="32" Width="160" Margin="0,0,8,0"/>
                            <Button x:Name="BtnElkeszitve" Command="{Binding ElkeszitveCommand}" Content="Elkészítve → Levonás" Height="32" Width="160"/>
                        </StackPanel>
                    </DockPanel>

                    <Border x:Name="AddRecipePanel"
                            Grid.Row="1"
                            Margin="10,0,10,6"
                            BorderThickness="1"
                            Padding="10"
                            Visibility="Collapsed">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="8"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="200"/>
                                <RowDefinition Height="10"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="360"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Recept neve:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                <TextBox x:Name="TxtUjReceptNev"
                                         Grid.Column="1"
                                         Height="28"
                                         VerticalContentAlignment="Center"
                                         Text="{Binding ReceptNev, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Grid.Column="3" Text="Elkészítés leírása:" VerticalAlignment="Top" Margin="0,0,6,0"/>
                                <TextBox x:Name="TxtUjReceptLeiras"
                                         Grid.Column="4"
                                         Height="80"
                                         AcceptsReturn="True"
                                         TextWrapping="Wrap"
                                         VerticalScrollBarVisibility="Auto"
                                         Text="{Binding Leiras, UpdateSourceTrigger=PropertyChanged}"/>
                            </Grid>

                            <TextBlock Grid.Row="2"
                                       Text="Hozzávalók"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,4"/>

                            <DataGrid x:Name="AddRecipeGrid"
                                      Grid.Row="3"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="True"
                                      CanUserDeleteRows="False"
                                      IsReadOnly="False"
                                      ItemsSource="{Binding Sorok}">
                                <DataGrid.Columns>
                                    <DataGridComboBoxColumn x:Name="AddRecipe_AlapanyagColumn"
                                                            Header="Alapanyag"
                                                            SelectedValueBinding="{Binding AlapanyagID, UpdateSourceTrigger=PropertyChanged}"
                                                            SelectedValuePath="AlapanyagID"
                                                            DisplayMemberPath="AlapanyagNev"
                                                            Width="*">

                                        <DataGridComboBoxColumn.ElementStyle>
                                            <Style TargetType="ComboBox">
                                                <Setter Property="ItemsSource"
                                                        Value="{Binding DataContext.Alapanyagok, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
                                                <Setter Property="IsHitTestVisible" Value="False"/>
                                                <Setter Property="Focusable" Value="False"/>
                                            </Style>
                                        </DataGridComboBoxColumn.ElementStyle>

                                        <DataGridComboBoxColumn.EditingElementStyle>
                                            <Style TargetType="ComboBox" BasedOn="{StaticResource ComboBox.EditingInGrid}">
                                                <Setter Property="ItemsSource"
                                                        Value="{Binding DataContext.Alapanyagok, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"/>
                                            </Style>
                                        </DataGridComboBoxColumn.EditingElementStyle>
                                    </DataGridComboBoxColumn>

                                    <DataGridTextColumn Header="Mennyiség"
                                                        Binding="{Binding Mennyiseg, UpdateSourceTrigger=PropertyChanged}"
                                                        Width="150"/>   
                                    <DataGridTextColumn Header="Mértékegység"
                                                        Binding="{Binding Mertekegyseg}"
                                                        IsReadOnly="True"
                                                        Width="150"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="BtnUjReceptMegsem" Click="OnRecipeAddRequested" Content="Mégse" Width="100" Height="32" Margin="0,0,8,0"/>
                                <Button x:Name="BtnUjReceptMentes" Content="Mentés" Width="120" Height="32" Command="{Binding SaveCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <Grid Grid.Row="2" Margin="10,0,10,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="230"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="260"/>
                        </Grid.ColumnDefinitions>

                        <ListView ItemsSource="{Binding RecipeListItems}"
                                  SelectedItem="{Binding SelectedRecipe, Mode=TwoWay}"
                                  SelectionMode="Single"
                                  Grid.Column="0" Margin="0">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="ID" Width="50" DisplayMemberBinding="{Binding ID}"/>
                                    <GridViewColumn Header="Receptek" Width="160" DisplayMemberBinding="{Binding Name}"/>
                                </GridView>
                            </ListView.View>
                        </ListView>


                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="6"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Kiválasztott recept részletei" FontWeight="SemiBold" Margin="0,0,0,6"/>

                            <TextBlock Grid.Row="1"
                                       Text="{Binding SelectedRecipeText}"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,6"/>

                            <DataGrid Grid.Row="2"
                                      ItemsSource="{Binding SelectedRecipeRows}"
                                      AutoGenerateColumns="False"
                                      IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Alapanyag" Binding="{Binding Alapanyag}" Width="*"/>
                                    <DataGridTextColumn Header="Mennyiség" Binding="{Binding Mennyiseg}" Width="120"/>
                                    <DataGridTextColumn Header="Mértékegység" Binding="{Binding Mertekegyseg}" Width="120"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <Rectangle Grid.Row="3" Height="6" Fill="Transparent"/>

                            <TextBlock Text="Bevásárlólista (hiányzó hozzávalók)" Grid.Row="4" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <DataGrid ItemsSource="{Binding ShoppingList}" Grid.Row="5" AutoGenerateColumns="True" IsReadOnly="True"/>
                        </Grid>

                        <Grid Grid.Column="4">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Kijelölt receptek" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <ListBox ItemsSource="{Binding SelectedRecipes}" Grid.Row="1">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="0,2">
                                            <TextBlock Text="{Binding}" VerticalAlignment="Center" />
                                            <Button Content="X"
                                                    Command="{Binding DataContext.RemoveSelectedCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                    CommandParameter="{Binding}"
                                                    Width="28" Height="24" Margin="6,0,0,0"
                                                    Background="Transparent" BorderBrush="{DynamicResource App.Border}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                        </Grid>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem x:Name="tabRaktar" Header="Hűtő &amp; Spájz">
                <Grid Background="{DynamicResource App.PanelBg}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="10,10,10,6">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="260"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="160"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" VerticalAlignment="Center" Margin="0,0,6,0" Text="Alapanyag:"/>
                        <ComboBox x:Name="CmbAlapanyag"
                                  Grid.Column="1" 
                                  Height="28"
                                  DisplayMemberPath="AlapanyagNev"
                                  SelectedItem="{Binding SelectedAlapanyag, Mode=TwoWay}"
                                  ItemsSource="{Binding AlapanyagLista}"/>

                        <TextBlock Grid.Column="3" VerticalAlignment="Center" Margin="0,0,6,0" Text="Mennyiség:"/>
                        <TextBox x:Name="TxtMennyiseg" 
                                 Grid.Column="4" 
                                 Height="28" 
                                 VerticalContentAlignment="Center"
                                 Text="{Binding UjMennyiseg, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock x:Name="LblUnit"
                                   Grid.Column="5"
                                   VerticalAlignment="Center"
                                   Margin="6,0,0,0"
                                   Text="{Binding SelectedItem.Mertekegyseg, ElementName=CmbAlapanyag}"
                                   Opacity="0.8"/>

                        <Button x:Name="AddItem_RS"
                                Grid.Column="7"
                                Width="120" 
                                Height="32"
                                Content="Hozzáadás"
                                Command="{Binding AddToRaktarCommand}"/>
                    </Grid>

                    <DataGrid x:Name="RefrigeratorStock"
                              ItemsSource="{Binding RaktarLista}"
                              Grid.Row="1"
                              Margin="10,0,10,10"
                              AutoGenerateColumns="False"
                              IsReadOnly="True">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="AlapanyagID" Binding="{Binding AlapanyagID}" Width="90"/>
                            <DataGridTextColumn Header="Alapanyag" Binding="{Binding Alapanyag.AlapanyagNev}" Width="*"/>
                            <DataGridTextColumn Header="Mértékegység" Binding="{Binding Alapanyag.Mertekegyseg}" Width="130"/>
                            <DataGridTextColumn Header="Mennyiség" Binding="{Binding Mennyiseg}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem x:Name="tabHozzavalok" Header="Hozzávalók">
                <Grid Background="{DynamicResource App.PanelBg}" Margin="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="14*"/>
                        <ColumnDefinition Width="37*"/>
                        <ColumnDefinition Width="496*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" Margin="10,10,10,6" Grid.ColumnSpan="3">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="220"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="180"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" VerticalAlignment="Center" Margin="0,0,6,0" Text="Alapanyag neve:"/>
                        <TextBox   x:Name="TxtAlapanyagNev" 
                                   Grid.Column="1" 
                                   Height="28" 
                                   VerticalContentAlignment="Center" 
                                   Text="{Binding UjAlapanyagNev, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Grid.Column="3" VerticalAlignment="Center" Margin="0,0,6,0" Text="Mértékegység:"/>
                        <TextBox   x:Name="TxtMertekegyseg" 
                                   Grid.Column="4" 
                                   Height="28" 
                                   VerticalContentAlignment="Center" 
                                   Text="{Binding UjMertekegyseg, UpdateSourceTrigger=PropertyChanged}"/>

                        <Button x:Name="AddItem_DB"
                                Grid.Column="6"
                                Width="120" Height="32"
                                Content="Hozzáadás"
                                Command="{Binding AddAlapanyagCommand}"/>
                    </Grid>

                    <DataGrid x:Name="ItemDB" 
                              ItemsSource="{Binding AlapanyagLista}"
                              Grid.Row="1" 
                              Margin="10,0,10,10" 
                              AutoGenerateColumns="False" 
                              IsReadOnly="True" 
                              CanUserSortColumns="True" 
                              Grid.ColumnSpan="3">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Alapanyag ID"
                                                Binding="{Binding AlapanyagID}"
                                                SortMemberPath="AlapanyagID"
                                                Width="80"/>
                            <DataGridTextColumn Header="Alapanyag neve"
                                                Binding="{Binding AlapanyagNev}"
                                                SortMemberPath="AlapanyagNev"
                                                Width="*"/>
                            <DataGridTextColumn Header="Mértékegysége"
                                                Binding="{Binding Mertekegyseg}"
                                                SortMemberPath="Mertekegyseg"
                                                Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

        </TabControl>
    </Grid>
</Window>